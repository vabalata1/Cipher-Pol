<section>
  <h1>Mandats codés</h1>
  <% if (currentUser?.isAdmin) { %>
    <p class="actions"><a class="btn btn-primary" href="/missions/new">Publier une mission</a></p>
  <% } %>
  <div class="mission-list">
    <% missions.forEach(function(m, i) { 
         const statusKey = (m.status || 'active').toString().toLowerCase();
         const statusLower = statusKey;
         const statusMap = { active: 'Actif', 'en_cours': 'En cours', done: 'Terminé', terminee: 'Terminé', closed: 'Clôturé', archived: 'Archivé' };
         const statusLabel = statusMap[statusKey] || (statusKey.charAt(0).toUpperCase() + statusKey.slice(1));
    %>
      <article class="mission-card">
        <div class="header">
          <a class="title" href="/missions/<%= m.id %>"><%= m.title %></a>
          <span class="status-badge status-<%= statusLower %>"><%= statusLabel %></span>
        </div>
        <% if (m.excerpt) { %>
          <p class="excerpt"><%= m.excerpt %>…</p>
        <% } %>
        <div class="hint">
          <span>#<%= i + 1 %></span>
          · <span><%= m.createdAt %></span>
          · <span><%= m.responsesCount %> réponse<%= m.responsesCount === 1 ? '' : 's' %></span>
        </div>
      </article>
    <% }) %>
  </div>
</section>


