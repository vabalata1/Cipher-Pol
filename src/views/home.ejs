<section class="grid">
  <div>
    <h2>Daily Brief</h2>
    <ul id="daily-brief" class="brief">
      <li>Chargementâ€¦</li>
    </ul>
    <div class="actions"><a class="btn btn-outline" href="#" id="refresh-brief">Actualiser</a></div>
  </div>
  <div>
    <h2>Alertes</h2>
    <ul id="alerts" class="alerts">
      <li class="hint">Aucune alerte</li>
    </ul>
  </div>
  <div>
    <h2>Indicateurs</h2>
    <div class="widgets">
      <div class="widget"><div class="k">OpÃ©rations actives</div><div class="v" id="w-ops">â€”</div></div>
      <div class="widget"><div class="k">Confiance globale</div><div class="v" id="w-trust">â€”</div></div>
      <div class="widget"><div class="k">MÃ©tÃ©o des rumeurs</div><div class="v" id="w-rumors">â€”</div></div>
    </div>
  </div>
</section>

<section class="grid">
  <div>
    <h2>Missions</h2>
    <div class="mission-grid">
      <% missions.forEach(m => { 
           const statusKey = (m.status || 'active').toString().toLowerCase();
           const statusLower = statusKey;
           const statusMap = { active: 'Actif', 'en_cours': 'En cours', done: 'TerminÃ©', terminee: 'TerminÃ©', closed: 'ClÃ´turÃ©', archived: 'ArchivÃ©' };
           const statusLabel = statusMap[statusKey] || (statusKey.charAt(0).toUpperCase() + statusKey.slice(1));
      %>
        <article class="mission-card">
          <div class="header">
            <a class="title" href="/missions/<%= m.id %>"><%= m.title %></a>
            <span class="status-badge status-<%= statusLower %>"><%= statusLabel %></span>
          </div>
          <% if (m.excerpt) { %>
            <p class="excerpt"><%= m.excerpt %>â€¦</p>
          <% } %>
        </article>
      <% }) %>
    </div>
    <div class="actions">
      <a class="btn btn-outline" href="/missions">Voir tout</a>
      <% if (currentUser?.isAdmin) { %>
        <a class="btn btn-primary" href="/missions/new">Publier</a>
      <% } %>
    </div>
  </div>
  <div>
    <h2>Infos & Rumeurs</h2>
    <ul>
      <% rumors.forEach(r => { %>
        <li><strong>[<%= r.codeTag %>]</strong> <%= r.excerpt %>â€¦ <small>(<%= r.credibility %>)</small></li>
      <% }) %>
      <li>
        <div class="actions">
          <a class="btn btn-outline" href="/rumors">Voir tout</a>
        </div>
      </li>
    </ul>
  </div>
  <div>
    <h2>Documents</h2>
    <div class="file-grid">
      <% files.forEach(f => { 
           const lower = (f.originalName || '').toLowerCase();
           const isImage = ['.png','.jpg','.jpeg','.gif','.webp'].some(ext => lower.endsWith(ext));
      %>
        <div class="file-card">
          <div class="file-thumb">
            <% if (isImage) { %>
              <a href="/files/download/<%= f.id %>"><img src="/files/raw/<%= f.id %>" alt="<%= f.originalName %>" /></a>
            <% } else { %>
              <div class="file-icon">ðŸ“„</div>
            <% } %>
          </div>
          <div class="file-meta">
            <div class="name"><strong>[<%= f.codeTag %>]</strong> <%= f.description && f.description.length ? f.description : 'Sans description' %></div>
            <div class="sub">par <%= f.uploaderCode %></div>
            <div class="actions"><a class="btn btn-secondary" href="/files">Ouvrir les archives</a></div>
          </div>
        </div>
      <% }) %>
    </div>
  </div>
</section>


